---
import { Icon } from "astro-icon/components";
import Button from "../../../components/button.astro";

const label = "Toggle theme";
---

<Button
  type="button"
  size={"icon"}
  aria-label={label}
  data-theme-toggle
  data-theme="light"
  class="group border border-border bg-background text-foreground hover:bg-accent data-[theme=dark]:bg-background data-[theme=dark]:text-foreground"
>
  <Icon
    class="h-4 w-4 group-data-[theme=dark]:hidden"
    name="ph:sun"
  />
  <Icon
    class="hidden h-4 w-4 group-data-[theme=dark]:inline-flex"
    name="ph:moon"
  />
  <span class="sr-only" data-theme-label>Theme</span>
  <span class="sr-only" data-theme-state>Light</span>
</Button>

<script is:inline>
  (() => {
    const storageKey = "theme-preference";
    const root = document.documentElement;
    const button = document.querySelector("[data-theme-toggle]");
    const stateLabel = document.querySelector("[data-theme-state]");

    if (!button || !stateLabel) return;

    const readPreference = () => {
      const stored = localStorage.getItem(storageKey);
      return stored === "dark" ? "dark" : "light";
    };

    const applyTheme = (theme) => {
      root.classList.toggle("dark", theme === "dark");
      button.dataset.theme = theme;
      stateLabel.textContent = theme === "dark" ? "Dark" : "Light";
      button.setAttribute("aria-pressed", theme === "dark");
    };

    const setPreference = (theme) => {
      localStorage.setItem(storageKey, theme);
      applyTheme(theme);
    };

    let theme = readPreference();
    applyTheme(theme);

    button.addEventListener("click", () => {
      theme = theme === "dark" ? "light" : "dark";
      setPreference(theme);
    });
  })();
</script>

